# D01 - quantized energy (token_diff) streaming params
checkpoint_path: "/home/johnny/action_ws/checkpoints/motion_tokenizer/epochs5_complete500_d01_m10/best.pt"
decoder_window_size: 480

device: "auto"
amp: true

auth: {}
visualize: false

input:
  type: "folder"
  path: "/home/johnny/action_ws/datasets/gt_raw_videos/D01"  # ignored in folder mode
  dir: "/home/johnny/action_ws/datasets/gt_raw_videos/D01"
  video_exts: [".mp4", ".mov", ".avi", ".mkv"]
  recursive: true
  eof_timeout_seconds: 1.0
  batch:
    enable_parallel: true
    gpu_ids: [0]
    max_procs_per_gpu: 1
    poll_interval_seconds: 0.2

target_fps: 10
resize_shorter: 320
stride: 4

debug_fsq: false

motion_gate:
  enable: true
  vel_norm_thr: 0.020
  min_active_ratio: 0.025
  debug: false

pre_gate:
  enable: true
  resize_shorter: 128
  diff_method: mad
  pixel_diff_thr: 0.02
  mad_thr: 0.005
  min_active_ratio: 0.05
  debug: false

jsonl_output: true
jsonl_path: "./video_action_segmenter/inference_outputs/stream_codes.jsonl"

display_fps: 10

energy:
  enable: true
  source: "quantized"           # prequant | quantized | velocity
  mode: "token_diff_l2_mean"    # l2_mean | token_diff_l2_mean
  jsonl_output: true
  jsonl_path: "/home/johnny/action_ws/datasets/output/energy_sweep_out/D01/stream_energy_quantized_token_diff_l2_mean.jsonl"
  visualize: false
  window_title: "Energy Curve"
  viz_window: 400
  plot_width: 720
  plot_height: 520
  y_min: null
  y_max: null
  plot_color: [0, 255, 0]
  viz_style: enhanced
  theme: academic_blue
  smoothing:
    enable: true
    method: "ema"
    alpha: 0.7
    window: 3
    use_for_seg: true
    visualize_both: true

segmentation:
  enable: true
  mode: "report"
  threshold: 1.9326171875
  report_path: "/home/johnny/action_ws/datasets/output/energy_sweep_report/D01/best_threshold_quantized_token_diff.json"
  report_key: "quantized_token_diff_best.best_j.thr"
  min_len_windows: 2
  output_dir: "/home/johnny/action_ws/datasets/output/segmentation_outputs/D01"
  codec: "mp4v"
  ext: ".mp4"
  align: "center"
  hysteresis_ratio: 0.95
  up_count: 2
  down_count: 2
  cooldown_windows: 1
  max_duration_seconds: 2.0
  export_codes: true
  codes_min_overlap_ratio: 0.25
  min_codes_windows: 2
  skip_if_exists: true
  allow_overlap: true

export:
  prequant: false
  prequant_dir: "./video_action_segmenter/inference_outputs/stream_prequant"

max_windows: 0

