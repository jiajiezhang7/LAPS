# Params for extracting training energy on GTEA split1
# All commands will run under conda env "laps"

# Motion Tokenizer checkpoint (will be produced after training)
checkpoint_path: "/home/johnny/action_ws/checkpoints/motion_tokenizer/epochs10_gtea_split1_m10_tracks_only/best.pt"

# Decoder window size (used for velocity normalization); keep in sync with training img_shape shorter side
decoder_window_size: 480

# Device
device: "auto"
amp: true

visualize: false

auth: {}

# Input source: training videos (symlink folder)
input:
  type: "folder"
  dir: "/home/johnny/action_ws/online_datasets/gtea/gtea/Videos_train.split1"
  video_exts: [".mp4", ".mov", ".avi", ".mkv"]
  recursive: true
  eof_timeout_seconds: 1.0
  batch:
    enable_parallel: true
    gpu_ids: [0]
    max_procs_per_gpu: 2
    poll_interval_seconds: 0.2

# Sampling & window
# T inferred from checkpoint's track_pred_horizon
target_fps: 10
resize_shorter: 320
stride: 4

debug_fsq: false

# Optional motion gate to skip static windows
motion_gate:
  enable: true
  vel_norm_thr: 0.020
  min_active_ratio: 0.025
  debug: false

# Pre-diff quick gate
pre_gate:
  enable: true
  resize_shorter: 128
  diff_method: mad
  pixel_diff_thr: 0.02
  mad_thr: 0.005
  min_active_ratio: 0.05
  debug: false

# Codes JSONL (for debugging)
jsonl_output: false
jsonl_path: "./video_action_segmenter/inference_outputs/stream_codes.jsonl"

display_fps: 10

# Energy extraction only (no segmentation here)
energy:
  enable: true
  source: "quantized"
  mode: "token_diff_l2_mean"
  jsonl_output: true
  jsonl_path: "/home/johnny/action_ws/output/gtea/energy_split1"
  visualize: false
  window_title: "Energy Curve"
  viz_window: 400
  plot_width: 720
  plot_height: 520
  y_min: null
  y_max: null
  viz_style: enhanced
  theme: academic_blue
  smoothing:
    enable: true
    method: "ema"
    alpha: 0.7
    window: 3
    use_for_seg: true
    visualize_both: false

# Segmentation disabled in this phase
segmentation:
  enable: false

# Export (disabled)
export:
  prequant: false
  prequant_dir: "./video_action_segmenter/inference_outputs/stream_prequant"

max_windows: 500000

