# Configuration for unsupervised clustering evaluation

# --- General Settings ---
# Random seed for reproducibility (KMeans, PCA, sampling).
seed: 0
# Number of clusters to find.
n_clusters: 2

kmin: 2
kmax: 12
kmeans_repeats: 3
kmeans_select_by: silhouette    # 可选：silhouette | calinski_harabasz | davies_bouldin | inertia
silhouette_sample_size: 0       # >0 时用于 silhouette 采样加速

# For HDBSCAN
hdb_min_cluster_size_grid: "20,40,80"

# Optional: merge original folder labels into coarser groups (keeps backward compatibility if omitted)
label_processing:
  # Map raw folder names to merged labels
  # Example: collapse all NOK subtypes to one 'nok' and unify OK naming
  merge_map:
    # NOK variants (including common typos and with/without 'videos_' prefix)
    videos_nok_apperance: nok
    videos_nok_eletric: nok
    videos_nok_appearance: nok
    videos_nok_electric: nok
    nok_apperance: nok
    nok_eletric: nok
    nok_appearance: nok
    nok_electric: nok
    nok: nok
    # OK variants
    videos_ok: ok
    ok: ok
    
# --- Feature Engineering (features.py) ---
features:
  bow:
    # Smoothing value for bincount in Bag-of-Words. Avoids zero counts.
    smoothing: 1.0e-8
    # Default codebook size to assume if it cannot be inferred from data.
    default_codebook_size: 2048
    # Transform for BoW features: none | sqrt | log1p | tfidf
    transform: tfidf

# --- Clustering & Preprocessing (cluster_eval.py) ---
preprocessing:
  avg_feature:
    pca:
      # Maximum number of dimensions to keep after PCA.
      max_dims: 32
      # Cumulative explained variance threshold to determine dimensions to keep.
      explained_variance_threshold: 0.99
      # Minimum number of PCA dimensions to keep.
      min_dims: 8
    # L2-normalize the PCA-projected vectors (recommended)
    l2_normalize: true
  bow_feature:
    # L2-normalize BoW features after transform (spherical clustering)
    l2_normalize: true
  lstm_feature:
    pca:
      max_dims: 0         # 0 disables PCA; set e.g. 50 to enable
      explained_variance_threshold: 0.99
      min_dims: 8
    l2_normalize: true

clustering:
  # Optional per-feature method override (when --feature both)
  method_by_feature:
    bow: kmeans
    avg: gmm
    lstm: kmeans
  # Fit KMeans on a class-balanced subset. If false, uses the full dataset.
  balance_fit: true
  # If balance_fit is true, this switch controls the evaluation scope.
  # If true: evaluate metrics ONLY on the balanced subset used for fitting.
  # If false: evaluate metrics on the entire dataset.
  evaluate_on_fit_subset: false
  kmeans:
    # Number of times KMeans will be run with different centroid seeds.
    n_init: 20
  gmm:
    # Covariance type for GaussianMixture: full | diag | tied | spherical
    covariance_type: full
  # HDBSCAN settings (used when method=hdbscan)
  hdbscan:
    # Minimum size of clusters; a good initial rule is max(10, round(1% of N))
    min_cluster_size: 20
    # If not set, defaults to min_cluster_size (more conservative density)
    min_samples: 3
    # Distance metric: 'euclidean' (recommended for L2-normalized vectors) or 'cosine'
    metric: euclidean
    # Cluster selection epsilon; keep 0.0 unless you know you need to split/merge
    cluster_selection_epsilon: 0.0
    # 'eom' (excess of mass) or 'leaf'; eom usually more stable
    cluster_selection_method: leaf
  # Bayesian Gaussian Mixture settings (used when method=bayes_gmm)
  bayes_gmm:
    # Upper bound on components; effective clusters are inferred by the model
    n_components: 12
    covariance_type: full
    weight_concentration_prior_type: dirichlet_process
    init_params: kmeans
    max_iter: 1000

# --- Visualization (cluster_eval.py) ---
visualization:
  umap:
    # Enable/disable UMAP plot generation.
    enabled: true
    # Number of neighbors for UMAP algorithm.
    n_neighbors: 15
    # Minimum distance for UMAP algorithm.
    min_dist: 0.1
    # UMAP distance metric for 'bow' features ('cosine', 'euclidean', etc.)
    bow_metric: 'cosine'
    # UMAP distance metric for 'avg' features ('euclidean', 'cosine', etc.)
    avg_metric: 'euclidean'
    # UMAP distance metric for 'lstm' embeddings
    lstm_metric: 'cosine'
    # Whether to include HDBSCAN noise points (-1) in UMAP visualizations.
    show_noise: true
    # Styling for noise points when show_noise is true.
    noise:
      color: '#b0b0b0'
      alpha: 0.4
      marker_size: 8
    plot:
      # Figure size for the scatter plot.
      figsize: [7, 6]
      # Marker size for scatter points.
      marker_size: 10
      # DPI for the saved image file.
      dpi: 200
